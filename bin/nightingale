#!/usr/bin/env ruby
# frozen_string_literal: true



require 'optparse'
require 'nightingale/cli'

opt_parser = OptionParser.new do |opt|
  opt.banner = 'Usage: nightingale COMMAND [OPTIONS]'
  opt.separator  ''
  opt.separator  'Commands'
  opt.separator  '     file: the path to the logfile'
  opt.separator  ''
  opt.separator  'Options'

  opt.on('-c', '--count', 'Show an aggragate total of unique traffic') do
    @count = true
  end

  opt.on('-f', '--file FILE', 'The file you would like to parse') do |file|
    puts("File: #{file}")
    cli = Nightingale::CLI.new(file)
    if @count
      cli.render_count
    else
      cli.render
    end
  end

  opt.on('-h', '--help', 'help') do
    puts opt_parser
  end
end

opt_parser.parse!


# require "pathname"
# ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../../Gemfile",
#   Pathname.new(__FILE__).realpath)

# bundle_binstub = File.expand_path("../bundle", __FILE__)

# if File.file?(bundle_binstub)
#   if File.read(bundle_binstub, 300) =~ /This file was generated by Bundler/
#     load(bundle_binstub)
#   else
#     abort("Your `bin/bundle` was not generated by Bundler, so this binstub cannot run.
# Replace `bin/bundle` by running `bundle binstubs bundler --force`, then run this command again.")
#   end
# end

# require "rubygems"
# require "bundler/setup"

# puts Gem.bin_path("nightingale", "nightingale")
# load Gem.bin_path("nightingale", "nightingale")
